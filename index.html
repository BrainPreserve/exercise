<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BrainPreserve — Exercise Coach</title>
  <meta name="description" content="CSV-driven exercise coaching for cognitive health with integrated AI addenda." />
  <link rel="stylesheet" href="assets/styles.css" />
  <!-- CDNs (no build tools) -->
  <script defer src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script defer src="assets/app.js"></script>
</head>
<body>
  <header class="app-header">
    <h1>BrainPreserve — Exercise Coach</h1>
    <nav class="tabs" aria-label="Primary">
      <button class="tab active" data-tab="plan">Plan</button>
      <button class="tab" data-tab="library">Library</button>
      <button class="tab" data-tab="progress">Progress</button>
      <button class="tab admin-only" data-tab="data" hidden>Data</button>
    </nav>
  </header>

  <main>
    <!-- PLAN -->
    <section id="plan" class="view active">
      <div class="grid-2">
        <div class="card">
          <h2>Today’s Inputs</h2>
          <form id="metricsForm" class="form-grid" autocomplete="off">
            <div>
              <label for="hrvBaseline">HRV 7-day baseline (ms)</label>
              <input id="hrvBaseline" type="number" min="1" step="1" placeholder="e.g., 40" required />
            </div>
            <div>
              <label for="hrvToday">HRV today (ms)</label>
              <input id="hrvToday" type="number" min="1" step="1" placeholder="e.g., 36" required />
            </div>
            <div>
              <label for="sleepEff">Sleep efficiency (%)</label>
              <input id="sleepEff" type="number" min="0" max="100" step="0.1" placeholder="e.g., 86" required />
            </div>
            <div>
              <label for="sbp">SBP (mmHg)</label>
              <input id="sbp" type="number" min="60" max="260" step="1" placeholder="e.g., 128" required />
            </div>
            <div>
              <label for="dbp">DBP (mmHg)</label>
              <input id="dbp" type="number" min="30" max="160" step="1" placeholder="e.g., 78" required />
            </div>
            <div>
              <label for="tir">CGM Time-in-Range 70–180 (%)</label>
              <input id="tir" type="number" min="0" max="100" step="0.1" placeholder="e.g., 78" required />
            </div>
            <div>
              <label for="crp">hs-CRP (mg/L)</label>
              <input id="crp" type="number" min="0" step="0.1" placeholder="e.g., 1.2" required />
            </div>
            <div>
              <label>Exercise Focus</label>
              <div class="radio-row">
                <label><input type="radio" name="focus" value="muscle" checked> Muscle</label>
                <label><input type="radio" name="focus" value="aerobic"> Aerobic</label>
                <label><input type="radio" name="focus" value="both"> Both</label>
              </div>
            </div>
            <div class="button-row">
              <button type="submit" class="btn primary">Generate Today’s Plan</button>
              <button id="clearMetrics" type="button" class="btn">Clear Form</button>
              <button id="saveMetrics" type="button" class="btn">Save Today</button>
            </div>
            <p id="saveMsg" class="save-msg" hidden>Saved. Check the <strong>Progress</strong> tab.</p>
          </form>
        </div>

        <div class="card">
          <h2>Today’s Plan</h2>
          <div id="planDeterministic" class="prose"></div>
          <div id="planAI" class="ai-block" hidden>
            <h3>AI Coaching Insights</h3>
            <div id="planAIText" class="prose"></div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Progress (HRV Δ% over time)</h2>
        <canvas id="progressChart" height="110"></canvas>
      </div>
    </section>

    <!-- LIBRARY -->
    <section id="library" class="view">
      <div class="filters card">
        <div class="filters-row">
          <details open>
            <summary>Goals</summary>
            <div id="goalChips" class="chips"></div>
          </details>
          <details open>
            <summary>Exercise Types</summary>
            <div id="typeChips" class="chips"></div>
          </details>
          <details>
            <summary>Practical constraints</summary>
            <div class="constraints">
              <div>
                <strong>Time available</strong>
                <div class="radio-row" id="timeRadios"></div>
                <p id="timeNotice" class="notice"></p>
              </div>
              <div>
                <strong>Equipment</strong>
                <div id="equipChips" class="chips"></div>
              </div>
            </div>
          </details>
        </div>
        <div class="filters-actions">
          <button id="clearLibrary" class="btn">Clear Fields</button>
        </div>
      </div>

      <div id="libraryList" class="cards"></div>
    </section>

    <!-- PROGRESS -->
    <section id="progress" class="view">
      <div class="card">
        <h2>Saved Metric Days</h2>
        <table id="daysTable" class="table"></table>
      </div>
    </section>

    <!-- DATA (hidden unless ?admin=1 or #admin) -->
    <section id="data" class="view" hidden>
      <div class="card">
        <h2>CSV Diagnostics</h2>
        <div class="diag-wrap">
          <div>
            <h3>Detected Columns</h3>
            <pre id="csvDiag" class="diag"></pre>
          </div>
          <div class="csv-preview">
            <h3>CSV Preview (first 50 rows)</h3>
            <table id="csvTable" class="table"></table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <small>© BrainPreserve.</small>
  </footer>
</body>
</html>
